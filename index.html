<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bella Vista Restaurant - Corrected Version</title>
    <meta name="robots" content="noindex, nofollow">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
            min-height: 100vh; 
            color: #333; 
            line-height: 1.4;
        }
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        .header { 
            background: white; 
            border-radius: 15px; 
            padding: 30px; 
            margin-bottom: 30px; 
            text-align: center; 
            box-shadow: 0 10px 30px rgba(0,0,0,0.1); 
        }
        .restaurant-name { 
            font-size: 2.8rem; 
            color: #D2691E; 
            margin-bottom: 10px; 
            font-weight: bold; 
        }
        .restaurant-tagline { 
            color: #666; 
            font-size: 1.2rem; 
            margin-bottom: 10px; 
        }
        .version-info { 
            color: #888; 
            font-size: 0.9rem; 
            font-style: italic; 
        }
        .status { 
            background: #d4edda; 
            border: 1px solid #c3e6cb; 
            color: #155724; 
            padding: 15px; 
            border-radius: 8px; 
            margin-bottom: 20px; 
            text-align: center; 
            font-weight: bold; 
        }
        .auth-panel { 
            background: #fff3cd; 
            border: 1px solid #ffeaa7; 
            color: #856404; 
            padding: 18px; 
            border-radius: 8px; 
            margin-bottom: 20px; 
        }
        .auth-title { 
            font-weight: bold; 
            margin-bottom: 12px; 
            font-size: 1.1rem; 
        }
        .token-status { 
            padding: 12px; 
            border-radius: 6px; 
            margin-top: 10px; 
            font-size: 0.95rem; 
            font-weight: 500; 
        }
        .token-status.success { 
            background: #d4edda; 
            color: #155724; 
            border: 1px solid #c3e6cb; 
        }
        .token-status.error { 
            background: #f8d7da; 
            color: #721c24; 
            border: 1px solid #f5c6cb; 
        }
        .token-status.checking { 
            background: #e2e3e5; 
            color: #495057; 
            border: 1px solid #ced4da; 
        }
        .content-grid { 
            display: grid; 
            grid-template-columns: 2fr 1fr; 
            gap: 30px; 
        }
        .menu-section { 
            background: white; 
            border-radius: 15px; 
            padding: 30px; 
            box-shadow: 0 10px 30px rgba(0,0,0,0.1); 
        }
        .menu-section h2 { 
            color: #D2691E; 
            font-size: 2rem; 
            margin-bottom: 25px; 
            font-weight: bold; 
        }
        .menu-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); 
            gap: 20px; 
        }
        .menu-item { 
            border: 1px solid #ddd; 
            border-radius: 10px; 
            padding: 20px; 
            background: #f8f9fa; 
            transition: all 0.3s ease; 
        }
        .menu-item:hover { 
            transform: translateY(-3px); 
            box-shadow: 0 8px 25px rgba(0,0,0,0.15); 
            border-color: #D2691E; 
        }
        .item-name { 
            font-size: 1.25rem; 
            font-weight: bold; 
            color: #333; 
            margin-bottom: 10px; 
        }
        .item-description { 
            color: #666; 
            margin-bottom: 15px; 
            line-height: 1.5; 
            font-size: 0.95rem; 
        }
        .item-footer { 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
        }
        .item-price { 
            font-size: 1.4rem; 
            font-weight: bold; 
            color: #D2691E; 
        }
        .add-btn { 
            background: #28a745; 
            color: white; 
            border: none; 
            padding: 10px 18px; 
            border-radius: 6px; 
            cursor: pointer; 
            font-weight: 600; 
            transition: all 0.3s; 
        }
        .add-btn:hover { 
            background: #218838; 
            transform: translateY(-1px); 
        }
        .cart-sidebar { 
            background: white; 
            border-radius: 15px; 
            padding: 30px; 
            box-shadow: 0 10px 30px rgba(0,0,0,0.1); 
            height: fit-content; 
            position: sticky; 
            top: 20px; 
        }
        .cart-header { 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            margin-bottom: 25px; 
        }
        .cart-header h3 { 
            color: #D2691E; 
            font-size: 1.5rem; 
            font-weight: bold; 
        }
        .cart-count { 
            background: #D2691E; 
            color: white; 
            border-radius: 50%; 
            width: 32px; 
            height: 32px; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            font-weight: bold; 
            font-size: 1rem; 
        }
        .cart-items { 
            max-height: 350px; 
            overflow-y: auto; 
            margin-bottom: 25px; 
        }
        .cart-item { 
            padding: 15px 0; 
            border-bottom: 1px solid #eee; 
        }
        .cart-item:last-child { 
            border-bottom: none; 
        }
        .cart-item-name { 
            font-weight: 600; 
            margin-bottom: 8px; 
            font-size: 1.05rem; 
        }
        .cart-item-price { 
            color: #666; 
            font-size: 0.9rem; 
            margin-bottom: 10px; 
        }
        .quantity-controls { 
            display: flex; 
            align-items: center; 
            gap: 12px; 
            margin-bottom: 10px; 
        }
        .qty-btn { 
            background: #D2691E; 
            color: white; 
            border: none; 
            width: 28px; 
            height: 28px; 
            border-radius: 50%; 
            cursor: pointer; 
            font-size: 1rem; 
            font-weight: bold; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
        }
        .qty-btn:hover { 
            background: #b8571b; 
        }
        .qty-display { 
            min-width: 30px; 
            text-align: center; 
            font-weight: 600; 
            font-size: 1.1rem; 
        }
        .remove-btn { 
            background: #dc3545; 
            color: white; 
            border: none; 
            padding: 5px 10px; 
            border-radius: 4px; 
            cursor: pointer; 
            font-size: 0.85rem; 
            font-weight: 500; 
        }
        .remove-btn:hover { 
            background: #c82333; 
        }
        .cart-totals { 
            border-top: 2px solid #ddd; 
            padding-top: 20px; 
            margin-bottom: 25px; 
        }
        .total-row { 
            display: flex; 
            justify-content: space-between; 
            margin: 8px 0; 
            font-size: 1rem; 
        }
        .total-row.grand-total { 
            font-weight: bold; 
            font-size: 1.3rem; 
            color: #D2691E; 
            border-top: 1px solid #ddd; 
            padding-top: 12px; 
            margin-top: 15px; 
        }
        .cart-actions { 
            display: flex; 
            flex-direction: column; 
            gap: 12px; 
        }
        .action-btn { 
            padding: 15px 25px; 
            border: none; 
            border-radius: 8px; 
            cursor: pointer; 
            font-weight: 600; 
            text-align: center; 
            transition: all 0.3s; 
            font-size: 1rem; 
        }
        .send-btn { 
            background: linear-gradient(45deg, #ff6b6b, #ff8e8e); 
            color: white; 
            font-size: 1.1rem; 
            box-shadow: 0 4px 15px rgba(255, 107, 107, 0.3); 
        }
        .send-btn:hover { 
            background: linear-gradient(45deg, #ff5252, #ff7575); 
            transform: translateY(-2px); 
            box-shadow: 0 6px 20px rgba(255, 107, 107, 0.4); 
        }
        .send-btn:disabled { 
            background: #6c757d; 
            cursor: not-allowed; 
            transform: none; 
            box-shadow: none; 
        }
        .clear-btn { 
            background: #ffc107; 
            color: #212529; 
        }
        .clear-btn:hover { 
            background: #ffb300; 
            transform: translateY(-1px); 
        }
        .empty-cart { 
            text-align: center; 
            color: #666; 
            padding: 30px 0; 
            font-size: 1rem; 
        }
        .message { 
            padding: 15px; 
            border-radius: 6px; 
            margin-bottom: 20px; 
            display: none; 
            font-weight: 500; 
            font-size: 0.95rem; 
        }
        .message.success { 
            background: #d4edda; 
            color: #155724; 
            border: 1px solid #c3e6cb; 
        }
        .message.error { 
            background: #f8d7da; 
            color: #721c24; 
            border: 1px solid #f5c6cb; 
        }
        .message.warning { 
            background: #fff3cd; 
            color: #856404; 
            border: 1px solid #ffeaa7; 
        }
        @media (max-width: 768px) { 
            .content-grid { 
                grid-template-columns: 1fr; 
            } 
            .restaurant-name { 
                font-size: 2.2rem; 
            } 
            .menu-grid { 
                grid-template-columns: 1fr; 
            } 
            .cart-sidebar { 
                position: static; 
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <h1 class="restaurant-name">🍽️ Bella Vista Restaurant</h1>
            <p class="restaurant-tagline">Corrected Repository System</p>
            <p class="version-info">Fixed for "application" Repository</p>
        </header>

        <div class="status">✅ System Corrected - Repository Name Fixed - Token Should Work Now</div>

        <div class="auth-panel">
            <div class="auth-title">🔐 GitHub Authentication Status</div>
            <div id="token-status" class="token-status checking">Validating token for correct repository...</div>
        </div>

        <div id="message" class="message"></div>

        <div class="content-grid">
            <section class="menu-section">
                <h2>Our Delicious Menu</h2>
                <div id="menu-items" class="menu-grid"></div>
            </section>

            <aside class="cart-sidebar">
                <div class="cart-header">
                    <h3>Your Order</h3>
                    <span id="cart-count" class="cart-count">0</span>
                </div>

                <div id="cart-items" class="cart-items"></div>

                <div class="cart-totals">
                    <div class="total-row">
                        <span>Subtotal:</span>
                        <span id="subtotal">$0.00</span>
                    </div>
                    <div class="total-row">
                        <span>Tax (10%):</span>
                        <span id="tax">$0.00</span>
                    </div>
                    <div class="total-row grand-total">
                        <span>Total:</span>
                        <span id="total">$0.00</span>
                    </div>
                </div>

                <div class="cart-actions">
                    <button id="send-btn" class="action-btn send-btn">🚀 SEND ORDER TO KITCHEN</button>
                    <button id="clear-btn" class="action-btn clear-btn">🗑️ Clear Cart</button>
                </div>
            </aside>
        </div>
    </div>

    <script>
        // CORRECTED SYSTEM WITH RIGHT REPOSITORY NAME

        const CONFIG = {
            token: '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',
            repo: 'apurv1155/application', // CORRECTED REPOSITORY NAME
            file: 'orders.json',
            apiBase: 'https://api.github.com',
            timeout: 25000,
            retryAttempts: 5,
            retryDelay: 2000
        };

        // Enhanced menu
        const MENU = [
            { id: 1, name: "Garlic Bread", price: 8.99, description: "Fresh baked artisan bread with roasted garlic butter and Italian herbs" },
            { id: 2, name: "Caesar Salad", price: 12.99, description: "Crisp romaine lettuce with house-made caesar dressing, croutons, and parmesan" },
            { id: 3, name: "Buffalo Wings", price: 14.99, description: "Spicy buffalo chicken wings served with cool ranch dipping sauce and celery" },
            { id: 4, name: "Mozzarella Sticks", price: 10.99, description: "Golden fried mozzarella cheese sticks with marinara sauce" },
            { id: 5, name: "Loaded Nachos", price: 13.99, description: "Tortilla chips loaded with cheese, jalapeños, sour cream, and salsa" },
            { id: 6, name: "Margherita Pizza", price: 18.99, description: "Classic wood-fired pizza with fresh tomato sauce, mozzarella, and basil" },
            { id: 7, name: "Chicken Alfredo", price: 22.99, description: "Creamy fettuccine pasta with grilled chicken breast and parmesan cheese" },
            { id: 8, name: "Grilled Salmon", price: 26.99, description: "Fresh Atlantic salmon with lemon herb butter and seasonal vegetables" },
            { id: 9, name: "Ribeye Steak", price: 29.99, description: "Premium 12oz ribeye steak cooked to perfection with garlic mashed potatoes" },
            { id: 10, name: "Fish Tacos", price: 19.99, description: "Grilled fish with fresh pico de gallo, avocado, and lime crema" },
            { id: 11, name: "BBQ Ribs", price: 24.99, description: "Tender pork ribs with house BBQ sauce, coleslaw, and fries" },
            { id: 12, name: "Chicken Parmesan", price: 21.99, description: "Breaded chicken breast with marinara, melted cheese, and spaghetti" },
            { id: 13, name: "Mushroom Risotto", price: 20.99, description: "Creamy arborio rice with wild mushrooms and truffle oil" },
            { id: 14, name: "Chocolate Lava Cake", price: 9.99, description: "Rich chocolate cake with molten center, served with vanilla ice cream" },
            { id: 15, name: "Cheesecake", price: 8.99, description: "New York style cheesecake with seasonal berry compote" },
            { id: 16, name: "Tiramisu", price: 10.99, description: "Classic Italian dessert with coffee-soaked ladyfingers and mascarpone" },
            { id: 17, name: "Fresh Brewed Coffee", price: 4.99, description: "Premium Colombian coffee - regular, decaf, or espresso" },
            { id: 18, name: "Fresh Juice", price: 6.99, description: "Orange, apple, cranberry, or tropical fruit blend" },
            { id: 19, name: "Craft Sodas", price: 3.99, description: "Coke, Sprite, Fanta, Dr Pepper, Root Beer, Ginger Ale" },
            { id: 20, name: "Iced Tea", price: 3.99, description: "Freshly brewed iced tea - sweet, unsweetened, or flavored" }
        ];

        let cart = {};
        let isTokenValid = false;
        let systemReady = false;

        // Initialize system with corrected repository
        document.addEventListener('DOMContentLoaded', function() {
            console.log('🍽️ Restaurant system initializing with corrected repository...');
            console.log('🔑 Using token:', CONFIG.token.substring(0, 10) + '...');
            console.log('📂 Repository:', CONFIG.repo);

            renderMenu();
            updateCart();
            setupEventListeners();
            validateTokenWithCorrectRepo();
        });

        // Token validation with corrected repository name
        async function validateTokenWithCorrectRepo() {
            console.log('🔐 Validating token with correct repository:', CONFIG.repo);
            updateTokenStatus('Validating token for correct repository...', 'checking');

            for (let attempt = 1; attempt <= CONFIG.retryAttempts; attempt++) {
                try {
                    console.log(`🔍 Validation attempt ${attempt}/${CONFIG.retryAttempts} for ${CONFIG.repo}`);

                    const response = await Promise.race([
                        fetch(`${CONFIG.apiBase}/repos/${CONFIG.repo}`, {
                            method: 'GET',
                            headers: {
                                'Authorization': `Bearer ${CONFIG.token}`,
                                'Accept': 'application/vnd.github+json',
                                'X-GitHub-Api-Version': '2022-11-28',
                                'User-Agent': 'BellaVista-Restaurant-Corrected',
                                'Content-Type': 'application/json'
                            }
                        }),
                        new Promise((_, reject) => 
                            setTimeout(() => reject(new Error('Validation timeout')), CONFIG.timeout)
                        )
                    ]);

                    if (response.ok) {
                        const repoData = await response.json();
                        console.log('✅ Token validation successful with correct repository!');
                        console.log('📂 Repository confirmed:', repoData.full_name);
                        console.log('🔒 Permissions verified:', repoData.permissions);

                        isTokenValid = true;
                        systemReady = true;

                        updateTokenStatus('✅ Token validated successfully - Correct repository found!', 'success');

                        // Initialize orders file
                        await initializeOrdersFile();
                        break;

                    } else if (response.status === 401) {
                        console.error('❌ Token authentication failed - 401 Unauthorized');
                        throw new Error('Token authentication failed');

                    } else if (response.status === 403) {
                        console.error('❌ Token permissions insufficient - 403 Forbidden');
                        throw new Error('Token lacks required permissions');

                    } else if (response.status === 404) {
                        console.error('❌ Repository not found - 404 Not Found');
                        throw new Error('Repository not found');

                    } else {
                        console.error('❌ GitHub API error:', response.status);
                        throw new Error(`GitHub API error: ${response.status}`);
                    }

                } catch (error) {
                    console.error(`❌ Validation attempt ${attempt} failed:`, error.message);

                    if (attempt === CONFIG.retryAttempts) {
                        isTokenValid = false;
                        systemReady = false;

                        if (error.message.includes('authentication failed')) {
                            updateTokenStatus('❌ Token authentication failed - Please check token', 'error');
                            showMessage('❌ Token authentication failed - Please verify token is correct', 'error');
                        } else if (error.message.includes('permissions')) {
                            updateTokenStatus('❌ Token lacks permissions - Need "repo" scope', 'error');
                            showMessage('❌ Token needs "repo" permission - Please recreate with proper scopes', 'error');
                        } else if (error.message.includes('not found')) {
                            updateTokenStatus('❌ Repository "application" not found - Check repository name', 'error');
                            showMessage('❌ Repository "apurv1155/application" not found or not accessible', 'error');
                        } else {
                            updateTokenStatus('❌ Validation failed - Connection issues', 'error');
                            showMessage('❌ Unable to validate token - Please try again', 'error');
                        }
                    } else {
                        await new Promise(resolve => setTimeout(resolve, CONFIG.retryDelay));
                    }
                }
            }
        }

        // Initialize orders file with corrected path
        async function initializeOrdersFile() {
            try {
                console.log('📁 Checking orders.json in application repository...');

                const response = await fetch(`${CONFIG.apiBase}/repos/${CONFIG.repo}/contents/${CONFIG.file}`, {
                    headers: {
                        'Authorization': `Bearer ${CONFIG.token}`,
                        'Accept': 'application/vnd.github+json',
                        'X-GitHub-Api-Version': '2022-11-28'
                    }
                });

                if (response.ok) {
                    console.log('✅ orders.json exists in application repository');
                    updateTokenStatus('✅ System ready - orders.json found in application repository', 'success');
                } else if (response.status === 404) {
                    console.log('📝 orders.json not found in application repository, creating...');
                    await createOrdersFile();
                }
            } catch (error) {
                console.error('❌ Error checking orders file:', error);
            }
        }

        // Create orders.json in application repository
        async function createOrdersFile() {
            try {
                console.log('🚀 Creating orders.json in application repository...');

                const initialContent = {
                    restaurant: 'Bella Vista Restaurant',
                    repository: 'application',
                    created: new Date().toISOString(),
                    lastUpdated: new Date().toISOString(),
                    totalOrders: 0,
                    system: 'corrected-repository-system',
                    version: '4.1',
                    tokenInfo: {
                        created: new Date().toISOString(),
                        repository: 'apurv1155/application',
                        status: 'active'
                    },
                    orders: []
                };

                const response = await fetch(`${CONFIG.apiBase}/repos/${CONFIG.repo}/contents/${CONFIG.file}`, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `Bearer ${CONFIG.token}`,
                        'Accept': 'application/vnd.github+json',
                        'X-GitHub-Api-Version': '2022-11-28',
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        message: 'Initialize orders.json in application repository',
                        content: btoa(JSON.stringify(initialContent, null, 2)),
                        branch: 'main'
                    })
                });

                if (response.ok) {
                    console.log('✅ orders.json created successfully in application repository');
                    updateTokenStatus('✅ System initialized - orders.json created in application repository', 'success');
                    showMessage('✅ System initialized successfully with corrected repository', 'success');
                } else {
                    console.error('❌ Failed to create orders.json');
                    updateTokenStatus('❌ Failed to create orders.json - Check permissions', 'error');
                }
            } catch (error) {
                console.error('❌ Error creating orders file:', error);
            }
        }

        function updateTokenStatus(message, type) {
            const statusEl = document.getElementById('token-status');
            if (statusEl) {
                statusEl.textContent = message;
                statusEl.className = `token-status ${type}`;
            }
        }

        function setupEventListeners() {
            const sendBtn = document.getElementById('send-btn');
            const clearBtn = document.getElementById('clear-btn');

            if (sendBtn) sendBtn.addEventListener('click', sendOrder);
            if (clearBtn) clearBtn.addEventListener('click', clearCart);
        }

        function renderMenu() {
            const container = document.getElementById('menu-items');
            if (!container) return;

            container.innerHTML = MENU.map(item => `
                <div class="menu-item">
                    <div class="item-name">${item.name}</div>
                    <div class="item-description">${item.description}</div>
                    <div class="item-footer">
                        <div class="item-price">$${item.price.toFixed(2)}</div>
                        <button class="add-btn" onclick="addToCart(${item.id})">Add to Cart</button>
                    </div>
                </div>
            `).join('');
        }

        function addToCart(itemId) {
            const item = MENU.find(i => i.id === itemId);
            if (!item) return;

            if (cart[itemId]) {
                cart[itemId].quantity += 1;
            } else {
                cart[itemId] = { ...item, quantity: 1 };
            }

            updateCart();
            showMessage(`${item.name} added to cart!`, 'success');
        }

        function updateCart() {
            const items = Object.values(cart);
            const container = document.getElementById('cart-items');

            if (!container) return;

            if (items.length === 0) {
                container.innerHTML = '<div class="empty-cart">Your cart is empty<br><small>Add some delicious items!</small></div>';
                document.getElementById('cart-count').textContent = '0';
                updateTotals(0, 0, 0);
                return;
            }

            container.innerHTML = items.map(item => `
                <div class="cart-item">
                    <div class="cart-item-name">${item.name}</div>
                    <div class="cart-item-price">$${item.price.toFixed(2)} each</div>
                    <div class="quantity-controls">
                        <button class="qty-btn" onclick="changeQuantity(${item.id}, -1)">−</button>
                        <span class="qty-display">${item.quantity}</span>
                        <button class="qty-btn" onclick="changeQuantity(${item.id}, 1)">+</button>
                    </div>
                    <button class="remove-btn" onclick="removeFromCart(${item.id})">Remove</button>
                </div>
            `).join('');

            const totalItems = items.reduce((sum, item) => sum + item.quantity, 0);
            document.getElementById('cart-count').textContent = totalItems;

            const subtotal = items.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            const tax = subtotal * 0.1;
            const total = subtotal + tax;

            updateTotals(subtotal, tax, total);
        }

        function changeQuantity(itemId, change) {
            if (cart[itemId]) {
                cart[itemId].quantity += change;
                if (cart[itemId].quantity <= 0) {
                    delete cart[itemId];
                }
                updateCart();
            }
        }

        function removeFromCart(itemId) {
            if (cart[itemId]) {
                const item = cart[itemId];
                delete cart[itemId];
                updateCart();
                showMessage(`${item.name} removed from cart`, 'success');
            }
        }

        function updateTotals(subtotal, tax, total) {
            const subtotalEl = document.getElementById('subtotal');
            const taxEl = document.getElementById('tax');
            const totalEl = document.getElementById('total');

            if (subtotalEl) subtotalEl.textContent = `$${subtotal.toFixed(2)}`;
            if (taxEl) taxEl.textContent = `$${tax.toFixed(2)}`;
            if (totalEl) totalEl.textContent = `$${total.toFixed(2)}`;
        }

        function clearCart() {
            if (Object.keys(cart).length > 0 && confirm('Clear cart?')) {
                cart = {};
                updateCart();
                showMessage('Cart cleared', 'success');
            }
        }

        // Send order to application repository
        async function sendOrder() {
            const items = Object.values(cart);
            if (items.length === 0) {
                showMessage('Cart is empty!', 'error');
                return;
            }

            if (!isTokenValid || !systemReady) {
                showMessage('❌ System not ready', 'error');
                return;
            }

            const sendBtn = document.getElementById('send-btn');
            sendBtn.disabled = true;
            sendBtn.textContent = 'SENDING...';

            try {
                const subtotal = items.reduce((sum, item) => sum + (item.price * item.quantity), 0);
                const tax = subtotal * 0.1;
                const total = subtotal + tax;

                const order = {
                    id: Date.now(),
                    orderNumber: `BV-${Date.now().toString().slice(-6)}`,
                    items: items,
                    subtotal: subtotal,
                    tax: tax,
                    total: total,
                    timestamp: new Date().toISOString(),
                    status: 'pending',
                    repository: 'application'
                };

                // Get existing orders
                let existingOrders = [];
                let fileSha = null;

                try {
                    const getResponse = await fetch(`${CONFIG.apiBase}/repos/${CONFIG.repo}/contents/${CONFIG.file}`, {
                        headers: {
                            'Authorization': `Bearer ${CONFIG.token}`,
                            'Accept': 'application/vnd.github+json',
                            'X-GitHub-Api-Version': '2022-11-28'
                        }
                    });

                    if (getResponse.ok) {
                        const fileData = await getResponse.json();
                        fileSha = fileData.sha;
                        const currentContent = JSON.parse(atob(fileData.content));
                        existingOrders = currentContent.orders || [];
                    }
                } catch (error) {
                    console.log('Creating new orders file...');
                }

                existingOrders.unshift(order);

                const fileContent = {
                    restaurant: 'Bella Vista Restaurant',
                    repository: 'application',
                    lastUpdated: new Date().toISOString(),
                    totalOrders: existingOrders.length,
                    orders: existingOrders
                };

                const commitData = {
                    message: `New order: ${order.orderNumber} ($${total.toFixed(2)}) [Application Repository]`,
                    content: btoa(JSON.stringify(fileContent, null, 2)),
                    branch: 'main'
                };

                if (fileSha) commitData.sha = fileSha;

                const commitResponse = await fetch(`${CONFIG.apiBase}/repos/${CONFIG.repo}/contents/${CONFIG.file}`, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `Bearer ${CONFIG.token}`,
                        'Accept': 'application/vnd.github+json',
                        'X-GitHub-Api-Version': '2022-11-28',
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(commitData)
                });

                if (commitResponse.ok) {
                    console.log('✅ Order sent to application repository');
                    showMessage(`✅ Order ${order.orderNumber} sent to kitchen!`, 'success');
                    cart = {};
                    updateCart();
                } else {
                    throw new Error(`Failed to send order: ${commitResponse.status}`);
                }

            } catch (error) {
                console.error('❌ Send order error:', error);
                showMessage(`❌ Failed to send order: ${error.message}`, 'error');
            } finally {
                sendBtn.disabled = false;
                sendBtn.textContent = '🚀 SEND ORDER TO KITCHEN';
            }
        }

        function showMessage(text, type) {
            const msg = document.getElementById('message');
            if (!msg) return;

            msg.textContent = text;
            msg.className = `message ${type}`;
            msg.style.display = 'block';

            setTimeout(() => { 
                msg.style.display = 'none'; 
            }, 5000);
        }

        // Global functions
        window.addToCart = addToCart;
        window.changeQuantity = changeQuantity;
        window.removeFromCart = removeFromCart;

        console.log('✅ Restaurant system loaded with corrected repository:', CONFIG.repo);
    </script>
</body>
</html>
